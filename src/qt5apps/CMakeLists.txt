cmake_minimum_required(VERSION 2.8.9)
# Accept new policy related to automatically linking Qt apps to qtmain.lib on Windows
cmake_policy(SET CMP0020 NEW)

find_package(Qt5Quick 5.1 REQUIRED)
find_package(Qt5Widgets 5.1 REQUIRED)
if(MARSYAS_OPENGL)
  find_package(Qt5OpenGL 5.1 REQUIRED)
endif()

add_subdirectory(common)

macro(marsyas_qt5_app APP)
  add_executable(${APP} ${ARGN})
  target_link_libraries(${APP} marsyas marsyasqt5)
  if(WIN32)
    set_property( TARGET ${APP} APPEND PROPERTY LINK_FLAGS "/SUBSYSTEM:windows /ENTRY:mainCRTStartup" )
  endif()
  install(TARGETS ${APP} DESTINATION bin)
endmacro()

if(WITH_CPP11)
  add_subdirectory(inspector)
endif()

if(MARSYAS_AUDIOIO AND MARSYAS_REALTIME)
  add_subdirectory(MarPlayer)
  add_subdirectory(MarGrid2)
  add_subdirectory(MarPhasevocoder)
  add_subdirectory(MarLpc)
  if(MARSYAS_OPENGL)
    add_subdirectory(MarPanning)
    add_subdirectory(MarSndPeek)
    add_subdirectory(MarCorrelogram)
  endif()
endif()

add_executable(qt-library-tester qt-library-tester.cpp)
qt5_use_modules(qt-library-tester Core Qml)
